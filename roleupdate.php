<?php
$access_token = "1000.186e8d3a4614e39fbb968ede125e3ec5.61fbcad2a5d3c674795716e9a6f4c541";
$movies = array(
array("user_Id"=>"1699841000465336599","email_id"=>"farhinbanu.saiyed@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C158245","first_Name"=>"Farhinbanu","reporting_id"=>"1699841000364934556","last_name"=>"Saiyed","State"=>""),
array("user_Id"=>"1699841000436947087","email_id"=>"mubassera.shaikh@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C158249","first_Name"=>"Mubassera","reporting_id"=>"1699841000364934556","last_name"=>"Shaikh","State"=>""),
array("user_Id"=>"1699841000436650816","email_id"=>"jashwanth.rathaud@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C158236","first_Name"=>"Jashwantsingh","reporting_id"=>"1699841000364934556","last_name"=>"Rathaud","State"=>""),
array("user_Id"=>"1699841000436818439","email_id"=>"henry.rodrigues@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C158253","first_Name"=>"Henry","reporting_id"=>"1699841000364934556","last_name"=>"rodrigues","State"=>""),
array("user_Id"=>"1699841000424135915","email_id"=>"bismilla.mansuri@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C158083","first_Name"=>"bismilla","reporting_id"=>"1699841000364934556","last_name"=>"mansuri","State"=>""),
array("user_Id"=>"1699841000425356113","email_id"=>"arthi.hulgolkar@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"","first_Name"=>"arthi","reporting_id"=>"1699841000364934556","last_name"=>"hulgolkar","State"=>""),
array("user_Id"=>"1699841000407012707","email_id"=>"vinod.cherukara@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C157827","first_Name"=>"vinod","reporting_id"=>"1699841000364934556","last_name"=>"cherukara","State"=>""),
array("user_Id"=>"1699841000360189001","email_id"=>"avinash.bhavsar@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C157274","first_Name"=>"Avinash","reporting_id"=>"1699841000364934556","last_name"=>"Bhavsar","State"=>"Partner Program"),
array("user_Id"=>"1699841000357589873","email_id"=>"ayushi.shah@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C157119","first_Name"=>"Ayushi ","reporting_id"=>"1699841000364934556","last_name"=>" Shah","State"=>"Partner Program"),
array("user_Id"=>"1699841000335055545","email_id"=>"a202590@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"a202590","first_Name"=>"tavishhusen","reporting_id"=>"1699841000364934556","last_name"=>"Ansari","State"=>"Partner Program"),
array("user_Id"=>"1699841000334620401","email_id"=>"bhavna.bhadka@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156866","first_Name"=>"bhavna","reporting_id"=>"1699841000364934556","last_name"=>"bhadka","State"=>"Partner Program"),
array("user_Id"=>"1699841000334765059","email_id"=>"shweta.chauhan@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156933","first_Name"=>"Shweta","reporting_id"=>"1699841000364934556","last_name"=>"chauhan","State"=>"Partner Program"),
array("user_Id"=>"1699841000333820388","email_id"=>"harshit.patel@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156941","first_Name"=>"Harshit","reporting_id"=>"1699841000364934556","last_name"=>"Patel","State"=>"Partner Program"),
array("user_Id"=>"1699841000333842569","email_id"=>"mansha.maurya@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156929","first_Name"=>"Mansha","reporting_id"=>"1699841000364934556","last_name"=>"Maurya","State"=>"Partner Program"),
array("user_Id"=>"1699841000311501787","email_id"=>"jainik.pancholi@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156706","first_Name"=>"JainikÂ ","reporting_id"=>"1699841000364934556","last_name"=>"Pancholi","State"=>"Partner Program"),
array("user_Id"=>"1699841000311564761","email_id"=>"anju.giri@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156697","first_Name"=>"Anju","reporting_id"=>"1699841000364934556","last_name"=>"Giri","State"=>"Partner Program"),
array("user_Id"=>"1699841000311457701","email_id"=>"vishvajitsinh.rao@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156692","first_Name"=>"Vishvajitsinh","reporting_id"=>"1699841000364934556","last_name"=>"Rao","State"=>"Partner Program"),
array("user_Id"=>"1699841000311564490","email_id"=>"mihir.patel@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156684","first_Name"=>"Mihir","reporting_id"=>"1699841000364934556","last_name"=>"Patel","State"=>"Partner Program"),
array("user_Id"=>"1699841000311516207","email_id"=>"darshan.mistry@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156683","first_Name"=>"Darshan","reporting_id"=>"1699841000364934556","last_name"=>"Mistry","State"=>"Partner Program"),
array("user_Id"=>"1699841000311367719","email_id"=>"ankita.bambuwala@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156676","first_Name"=>"Ankita","reporting_id"=>"1699841000364934556","last_name"=>"Bambuwala","State"=>"Partner Program"),
array("user_Id"=>"1699841000299318700","email_id"=>"namrata.sharma@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156463","first_Name"=>"Namrata","reporting_id"=>"1699841000364934556","last_name"=>"Sharma","State"=>"Partner Program"),
array("user_Id"=>"1699841000299354127","email_id"=>"mitali.jain@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156462","first_Name"=>"Mitali","reporting_id"=>"1699841000364934556","last_name"=>"Jain","State"=>"Partner Program"),
array("user_Id"=>"1699841000286935641","email_id"=>"himanshu.chavda@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156293","first_Name"=>"Himanshu","reporting_id"=>"1699841000364934556","last_name"=>"Chavda","State"=>"Partner Program"),
array("user_Id"=>"1699841000287105075","email_id"=>"krishnaben.ranpariya@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156279","first_Name"=>"Krishnaben","reporting_id"=>"1699841000364934556","last_name"=>"Ranpariya","State"=>"Partner Program"),
array("user_Id"=>"1699841000285812943","email_id"=>"a202459@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"a202459","first_Name"=>"Bhumika","reporting_id"=>"1699841000364934556","last_name"=>"Rajput","State"=>"Partner Program"),
array("user_Id"=>"1699841000287068230","email_id"=>"kajal.rajput@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156262","first_Name"=>"Kajal","reporting_id"=>"1699841000364934556","last_name"=>"Rajput","State"=>"Partner Program"),
array("user_Id"=>"1699841000272351241","email_id"=>"rajnikant.vora@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156050","first_Name"=>"Rajnikant","reporting_id"=>"1699841000364934556","last_name"=>"Vora","State"=>"Partner Program"),
array("user_Id"=>"1699841000272581280","email_id"=>"revathi.mudliyar@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C156049","first_Name"=>"Revathi","reporting_id"=>"1699841000364934556","last_name"=>"Mudliyar","State"=>"Partner Program"),
array("user_Id"=>"1699841000272376579","email_id"=>"salauddin.ansari@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C155954","first_Name"=>"Salauddin","reporting_id"=>"1699841000364934556","last_name"=>"Ansari","State"=>"Partner Program"),
array("user_Id"=>"1699841000207067007","email_id"=>"a202206@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"A202206","first_Name"=>"Allwyn","reporting_id"=>"1699841000364934556","last_name"=>"Lobo","State"=>""),
array("user_Id"=>"1699841000095408424","email_id"=>"priyanka.dubey@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"","first_Name"=>"Priyanka","reporting_id"=>"1699841000364934556","last_name"=>"Dubey","State"=>""),
array("user_Id"=>"1699841000013902039","email_id"=>"nikita.patel@5paisa.com","role_id"=>"1699841000364768465","Emp_Code"=>"C146401","first_Name"=>"Nikita","reporting_id"=>"1699841000364934556","last_name"=>"Patel","State"=>"Maharashrtra"),
array("user_Id"=>"1699841000424072985","email_id"=>"sudharshan.j@5paisa.com","role_id"=>"1699841000342631699","Emp_Code"=>"C158094","first_Name"=>"sudharshan","reporting_id"=>"1699841000050396825","last_name"=>"j","State"=>""),
array("user_Id"=>"1699841000361193458","email_id"=>"a202567@5paisa.com","role_id"=>"1699841000054920710","Emp_Code"=>"A202567","first_Name"=>"Vanrajsinh","reporting_id"=>"1699841000004797785","last_name"=>"Thanaji Thakor","State"=>""),
array("user_Id"=>"1699841000360171035","email_id"=>"indrajit.yadav@5paisa.com","role_id"=>"1699841000054920710","Emp_Code"=>"","first_Name"=>"Indrajit","reporting_id"=>"1699841000004797785","last_name"=>"Yadav","State"=>""),
array("user_Id"=>"1699841000148693013","email_id"=>"devang.relan@5paisa.com","role_id"=>"1699841000054920710","Emp_Code"=>"C152521","first_Name"=>"Devang","reporting_id"=>"1699841000004797785","last_name"=>"Relan","State"=>"null"),
array("user_Id"=>"1699841000130490080","email_id"=>"vikas.kanojiya@5paisa.com","role_id"=>"1699841000054920710","Emp_Code"=>"C152377","first_Name"=>"Vikas","reporting_id"=>"1699841000004797785","last_name"=>"Kanojiya","State"=>""),
array("user_Id"=>"1699841000351742188","email_id"=>"fatima.shaikh@5paisa.com","role_id"=>"1699841000342631679","Emp_Code"=>"C148598","first_Name"=>"Trial","reporting_id"=>"","last_name"=>"Trial","State"=>""),
array("user_Id"=>"1699841000048426389","email_id"=>"bhavna.torani@5paisa.com","role_id"=>"1699841000342631763","Emp_Code"=>"C148755","first_Name"=>"Bhavna","reporting_id"=>"","last_name"=>"Torani","State"=>""),
array("user_Id"=>"1699841000028483753","email_id"=>"vikram.sahni@5paisa.com","role_id"=>"1699841000528487611","Emp_Code"=>"C147539","first_Name"=>"Vikram","reporting_id"=>"","last_name"=>"Sahni","State"=>""),
array("user_Id"=>"1699841000418337307","email_id"=>"mayur.dedhia@5paisa.com","role_id"=>"1699841000416188111","Emp_Code"=>"C139162","first_Name"=>"mayur","reporting_id"=>"","last_name"=>"dedhia","State"=>""),
array("user_Id"=>"1699841000490190248","email_id"=>"jicky.thomas@5paisa.com","role_id"=>"1699841000536240395","Emp_Code"=>"","first_Name"=>"Jicky","reporting_id"=>"","last_name"=>"Thomas","State"=>""),
array("user_Id"=>"1699841000388062331","email_id"=>"nirav.sanghani@5paisa.com","role_id"=>"1699841000054920702","Emp_Code"=>"C157714","first_Name"=>"nirav","reporting_id"=>"1699841000004860116","last_name"=>"Sanghani","State"=>""),
array("user_Id"=>"1699841000379413030","email_id"=>"natasha.dsouza@5paisa.com","role_id"=>"1699841000054920702","Emp_Code"=>"C157085","first_Name"=>"Natasha","reporting_id"=>"1699841000004860116","last_name"=>"Dsouza","State"=>""),
array("user_Id"=>"1699841000293557508","email_id"=>"kalpana.shelar@5paisa.com","role_id"=>"1699841000054920702","Emp_Code"=>"C156301","first_Name"=>"Kalpana","reporting_id"=>"1699841000004860116","last_name"=>" Shelar	","State"=>""),
array("user_Id"=>"1699841000257608932","email_id"=>"sanjay.verma@5paisa.com","role_id"=>"1699841000054920702","Emp_Code"=>"C154952","first_Name"=>"Sanjay","reporting_id"=>"1699841000004860116","last_name"=>"Verma","State"=>""),
array("user_Id"=>"1699841000211769579","email_id"=>"nilesh.tiwari@5paisa.com","role_id"=>"1699841000054920702","Emp_Code"=>"C154005","first_Name"=>"Nilesh","reporting_id"=>"1699841000004860116","last_name"=>"Tiwari","State"=>""),
array("user_Id"=>"1699841000030022001","email_id"=>"roshani.parab@5paisa.com","role_id"=>"1699841000054920702","Emp_Code"=>"C147469","first_Name"=>"Roshani","reporting_id"=>"1699841000004860116","last_name"=>"Parab","State"=>""),
array("user_Id"=>"1699841000536361001","email_id"=>"karan.vaghela@5paisa.com","role_id"=>"1699841000401012188","Emp_Code"=>"","first_Name"=>"Karan","reporting_id"=>"1699841000004860116","last_name"=>"Vaghela","State"=>""),
array("user_Id"=>"1699841000007583808","email_id"=>"dk677905@gmail.com","role_id"=>"1699841000342631691","Emp_Code"=>"C145200","first_Name"=>"FFImran","reporting_id"=>"1699841000050396825","last_name"=>"Ansari","State"=>"Mumbai"),
array("user_Id"=>"1699841000130042781","email_id"=>"aniruddha.ghotkar@5paisa.com","role_id"=>"1699841000342631755","Emp_Code"=>"C152137","first_Name"=>"Aniruddha","reporting_id"=>"1699841000004860116","last_name"=>"Ghotkar","State"=>""),
array("user_Id"=>"1699841000007044472","email_id"=>"brijesh.singh@5paisa.com","role_id"=>"1699841000342631755","Emp_Code"=>"C145064","first_Name"=>"Brijesh","reporting_id"=>"1699841000004860116","last_name"=>"Singh","State"=>""),
array("user_Id"=>"1699841000004797785","email_id"=>"ravinder.hundal@5paisa.com","role_id"=>"1699841000342631755","Emp_Code"=>"C144646","first_Name"=>"Ravinder","reporting_id"=>"1699841000004860116","last_name"=>"Hundal","State"=>""),
array("user_Id"=>"1699841000329036095","email_id"=>"gajendra.dhakad@5paisa.com","role_id"=>"1699841000401012249","Emp_Code"=>"C156924","first_Name"=>"Gajendra","reporting_id"=>"1699841000004860116","last_name"=>"dhakad","State"=>""));
$userd_id_param="user_Id";
$role_id_param="role_id";
$Emp_Code_param="Emp_Code";
$reporting_id_param="reporting_id";
$last_name_param="last_name";
$state_param="state";
foreach ( $movies as $movie ) {
  foreach ( $movie as $key => $value ) {
    error_log ("<dt>$key</dt><dd>$value</dd>");
    if(strpos($key, $userd_id_param)!== false){
      $recordId = $value;
    }
    if(strpos($key, $role_id_param)!== false){
      $role_id = '"'.$value.'"';
    }
    if(strpos($key, $Emp_Code_param)!== false){
      $Emp_Code = '"'.$value.'"';
    }
    if(strpos($key, $state_param)!== false){
      $state = '"'.$value.'"';
    }
    if(strpos($key, $last_name_param)!== false){
      $last_name = '"'.$value.'"';
    }
    if(strpos($key, $reporting_id_param)!== false){
      $reporting_id = '"'.$value.'"';
    }
  }
  $url = "https://www.zohoapis.com/crm/v2/users/$recordId";
  error_log($url);
  $accesstokenparam = "Zoho-oauthtoken"." ".$access_token;
  $headers = array("Authorization: $accesstokenparam");
  $content_type = "application/json";
  //$headers->Content-type = $content_type;
  //$headers->Authorization = $accesstokenparam;
  error_log(json_encode($headers));
  $ch = curl_init();
  $param1 = '{"users":[{"Reporting_To":{"id":';
  //$param1 = '{"users":[{"role":';
  //$param10 = ',"role_id":';
  $param9 = ',"reporting_to_id":';
  $reportingid = $reporting_id;
  //$param2 = ', "Emp_Code":';
  //$param3 = ', "state":';
  $param4 = '}}]}'; 
  //$param4 = '}]}'; 
  /*
  {
    "users": [
       {
"role":"${ROLE_ID}"
        }
    ]
}*/
  
  /*
  {
     "users":[
         {
            "Reporting_To":
            {
                "id":"${REPORTING_TO_ID}"
            }
         }
     ]
}*/
  
  $json = $param1.$reportingid.$param4;
  //$json = $param1.$role_id.$param4;
  //$json = $param1.$last_name.$param10.$reportingid.$param2.$Emp_Code.$param3.$state.$param4;
  //$json = $param1.$last_name.$param2.$Emp_Code.$param3.$state.$param4;
  error_log($json);
  $result = json_decode ($json);
  curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
  curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT");
  curl_setopt($ch, CURLOPT_POSTFIELDS,$json);
  curl_setopt($ch, CURLOPT_URL, $url);
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);  
  $st=curl_exec($ch);
  error_log("first response");
  error_log($st);
  $Code = "code";
  $Message = "message";
  $AlternatePhoneNumber = "invalid";
  $AlternatePhoneNumber2 = "FAILURE";
  $arr = (json_decode($st, true));
  foreach ( $arr as $key=>$val ){
    if(strpos($key, $Message)!== false){
      if(strpos($val, $AlternatePhoneNumber)!== false){
        $REFRESH_TOKEN_ID = '1000.e6c1444c8dfe5be81e2071d68c92e76b.0442c58394e29dde316f5be4057484ec';
        $CLIENT_ID = '1000.KCRJ9GWGPIJZ56008726DSCMDAUI8U';
        $CLIENT_SECRET = '034bc2464c3093c42b6605b6297af733557ffcc3cb';
        $accesstokenurl = "https://accounts.zoho.com/oauth/v2/token?refresh_token=1000.e6c1444c8dfe5be81e2071d68c92e76b.0442c58394e29dde316f5be4057484ec&client_id=1000.KCRJ9GWGPIJZ56008726DSCMDAUI8U&client_secret=034bc2464c3093c42b6605b6297af733557ffcc3cb&grant_type=refresh_token";
        //$grant_type = 'refresh_token';
        //error_log($accesstokenurl);
        $tokench = curl_init();
        $myObj->grant_type = $grant_type;
        $myObj->refresh_token = $REFRESH_TOKEN_ID;
        $myObj->client_id = $CLIENT_ID;
        $myObj->client_secret=$CLIENT_SECRET;
        $tokenjson = json_encode($myObj);
        curl_setopt($tokench, CURLOPT_CUSTOMREQUEST, "POST");
        curl_setopt($tokench, CURLOPT_URL, $accesstokenurl);
        curl_setopt($tokench, CURLOPT_RETURNTRANSFER, 1);  
        $tokenst=curl_exec($tokench);
        error_log("token response");
        error_log($tokenst);
        $access_token_param="access_token";
        $arr = (json_decode($tokenst, true));
        foreach ( $arr as $key=>$val ){
          if(strpos($key, $access_token_param)!== false){
            error_log($val);
            $access_token=$val;
            //$url = "https://www.zohoapis.com/crm/v2/users/{$recordId}";
            $url = "https://crm.zoho.com/crm/v2/Users";
            error_log($url);
            $accesstokenparam = "Zoho-oauthtoken"." ".$access_token;
            $headers = array("Authorization: $accesstokenparam");
            $content_type = "application/json";
            error_log(json_encode($headers));
            $ch = curl_init();
            $result = json_decode ($json);
            curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
            curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT");
            curl_setopt($ch, CURLOPT_POSTFIELDS,$json);
            curl_setopt($ch, CURLOPT_URL, $url);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);  
            $st=curl_exec($ch);
            error_log("first response");
            error_log($st);          
          }
        }
      }
    }
  }
}
?>
