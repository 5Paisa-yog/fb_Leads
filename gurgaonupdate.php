<?php
$access_token = "1000.7cc6c4b53bdd0c739898b8c993d40a99.f53a855911c453c150b3a2640e597727";
$movies = array(
array("user_Id"=>"1699841000045025956","email_id"=>"kundan.kumar@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000069622901","Emp_Code"=>"C148553","State"=>"Gurgaon"),
array("user_Id"=>"1699841000045515398","email_id"=>"rahul.kumar2@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000069622901","Emp_Code"=>"C148546","State"=>"Gurgaon"),
array("user_Id"=>"1699841000057227239","email_id"=>"prashant.verma@5paisa.com","role_id"=>"1699841000342631771","profile_id"=>"1699841000014596081","reporting_id"=>"1699841000069622901","Emp_Code"=>"C148935","State"=>"Gurgaon"),
array("user_Id"=>"1699841000057296078","email_id"=>"pushpendra.chaturvedi@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000069622901","Emp_Code"=>"C149152","State"=>"Gurgaon"),
array("user_Id"=>"1699841000062264056","email_id"=>"vedanand.tirath@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000069622901","Emp_Code"=>"C149533","State"=>"Gurgaon"),
array("user_Id"=>"1699841000062266106","email_id"=>"praveen.singh@5paisa.com","role_id"=>"1699841000342631771","profile_id"=>"1699841000014596081","reporting_id"=>"1699841000092614109","Emp_Code"=>"C149543","State"=>"Gurgaon"),
array("user_Id"=>"1699841000090059990","email_id"=>"gunjita.mehra@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000145403094","Emp_Code"=>"C150702","State"=>"Gurgaon"),
array("user_Id"=>"1699841000090121381","email_id"=>"nitin.chand@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000069622901","Emp_Code"=>"C150821","State"=>"Gurgaon"),
array("user_Id"=>"1699841000090144376","email_id"=>"monu.bhandari@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000145403094","Emp_Code"=>"C150700","State"=>"Gurgaon"),
array("user_Id"=>"1699841000098339485","email_id"=>"shivani.gupta@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000046490296","Emp_Code"=>"C151147","State"=>"Gurgaon"),
array("user_Id"=>"1699841000098354938","email_id"=>"a201944@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000046490296","Emp_Code"=>"A201944","State"=>"Gurgaon"),
array("user_Id"=>"1699841000098357176","email_id"=>"shikha.dhanda@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000046490296","Emp_Code"=>"C151098","State"=>"Gurgaon"),
array("user_Id"=>"1699841000098369363","email_id"=>"a201946@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000057227239","Emp_Code"=>"A201946","State"=>"Gurgaon"),
array("user_Id"=>"1699841000098374152","email_id"=>"priya.jaiswal@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000145403094","Emp_Code"=>"C151146","State"=>"Gurgaon"),
array("user_Id"=>"1699841000098387269","email_id"=>"a201949@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000145403094","Emp_Code"=>"A201949","State"=>"Gurgaon"),
array("user_Id"=>"1699841000098399025","email_id"=>"atul.virdhi@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000069622901","Emp_Code"=>"C151142","State"=>"Gurgaon"),
array("user_Id"=>"1699841000098401041","email_id"=>"a201950@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000057227239","Emp_Code"=>"A201950","State"=>"Gurgaon"),
array("user_Id"=>"1699841000098401045","email_id"=>"jyoti.gupta@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000069622901","Emp_Code"=>"C151116","State"=>"Gurgaon"),
array("user_Id"=>"1699841000182780734","email_id"=>"a202104@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000062257192","Emp_Code"=>"a202104","State"=>"Gurgaon"),
array("user_Id"=>"1699841000182839702","email_id"=>"a202097@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000046490296","Emp_Code"=>"a202097","State"=>"Gurgaon"),
array("user_Id"=>"1699841000183393412","email_id"=>"ashukumar.ray@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000062257192","Emp_Code"=>"C153726","State"=>"Gurgaon"),
array("user_Id"=>"1699841000183440228","email_id"=>"a202098@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000069622901","Emp_Code"=>"a202098","State"=>"Gurgaon"),
array("user_Id"=>"1699841000183495003","email_id"=>"a202099@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000062257192","Emp_Code"=>"a202099","State"=>"Gurgaon"),
array("user_Id"=>"1699841000185110257","email_id"=>"a202106@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000062257192","Emp_Code"=>"a202106","State"=>"Gurgaon"),
array("user_Id"=>"1699841000211900548","email_id"=>"a202246@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000055816361","Emp_Code"=>"a202246","State"=>"Gurgaon"),
array("user_Id"=>"1699841000211964996","email_id"=>"a202248@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000145403094","Emp_Code"=>"a202248","State"=>"Gurgaon"),
array("user_Id"=>"1699841000211969368","email_id"=>"a202242@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000055816361","Emp_Code"=>"a202242","State"=>"Gurgaon"),
array("user_Id"=>"1699841000211976778","email_id"=>"a202245@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000062266106","Emp_Code"=>"a202245","State"=>"Gurgaon"),
array("user_Id"=>"1699841000212006269","email_id"=>"a202249@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000062266106","Emp_Code"=>"a202249","State"=>"Gurgaon"),
array("user_Id"=>"1699841000212006273","email_id"=>"a202252@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000055816361","Emp_Code"=>"a202252","State"=>"Gurgaon"),
array("user_Id"=>"1699841000212019255","email_id"=>"a202241@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000055816361","Emp_Code"=>"a202241","State"=>"Gurgaon"),
array("user_Id"=>"1699841000212068258","email_id"=>"a202250@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000055816361","Emp_Code"=>"a202250","State"=>"Gurgaon"),
array("user_Id"=>"1699841000212080104","email_id"=>"a202247@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000046490296","Emp_Code"=>"a202247","State"=>"Gurgaon"),
array("user_Id"=>"1699841000222961705","email_id"=>"a202244@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000057227239","Emp_Code"=>"a202244","State"=>"Gurgaon"),
array("user_Id"=>"1699841000224250668","email_id"=>"a202293@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000055816361","Emp_Code"=>"a202293","State"=>"Gurgaon"),
array("user_Id"=>"1699841000224255451","email_id"=>"a202267@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000145403094","Emp_Code"=>"a202267","State"=>"Gurgaon"),
array("user_Id"=>"1699841000224280950","email_id"=>"a202294@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000145403094","Emp_Code"=>"a202294","State"=>"Gurgaon"),
array("user_Id"=>"1699841000224295458","email_id"=>"a202289@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000055816361","Emp_Code"=>"a202289","State"=>"Gurgaon"),
array("user_Id"=>"1699841000224324230","email_id"=>"a202265@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000062266106","Emp_Code"=>"a202265","State"=>"Gurgaon"),
array("user_Id"=>"1699841000224540808","email_id"=>"a202291@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000055816361","Emp_Code"=>"a202291","State"=>"Gurgaon"),
array("user_Id"=>"1699841000233636861","email_id"=>"a202309@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000046490296","Emp_Code"=>"a202309","State"=>"Gurgaon"),
array("user_Id"=>"1699841000234359903","email_id"=>"a202301@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000055816361","Emp_Code"=>"a202301","State"=>"Gurgaon"),
array("user_Id"=>"1699841000236541208","email_id"=>"a202353@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000003603278","reporting_id"=>"1699841000057227239","Emp_Code"=>"a202353","State"=>"Gurgaon"),
array("user_Id"=>"1699841000339462827","email_id"=>"satya.dev@5paisa.com","role_id"=>"1699841000342631775","profile_id"=>"1699841000000126001","reporting_id"=>"1699841000046490296","Emp_Code"=>"C156861","State"=>"Gurgaon"),
array("user_Id"=>"1699841000048426389","email_id"=>"bhavna.torani@5paisa.com","role_id"=>"1699841000342631763","profile_id"=>"1699841000158432348","reporting_id"=>"","Emp_Code"=>"C148755","State"=>"Gurgaon"),
array("user_Id"=>"1699841000046490296","email_id"=>"vikassharma@5paisa.com","role_id"=>"1699841000342631771","profile_id"=>"1699841000014596081","reporting_id"=>"1699841000092614109","Emp_Code"=>"C148610","State"=>"Gurgaon"),
array("user_Id"=>"1699841000062257192","email_id"=>"s.mannu@5paisa.com","role_id"=>"1699841000342631771","profile_id"=>"1699841000014596081","reporting_id"=>"1699841000092614109","Emp_Code"=>"C149544","State"=>"Gurgaon"),
array("user_Id"=>"1699841000062523410","email_id"=>"arinder.singh@5paisa.com","role_id"=>"1699841000342631771","profile_id"=>"1699841000014596081","reporting_id"=>"1699841000092614109","Emp_Code"=>"C149525","State"=>"Gurgaon"),
array("user_Id"=>"1699841000069622901","email_id"=>"rohit.pathak@5paisa.com","role_id"=>"1699841000342631771","profile_id"=>"1699841000014596081","reporting_id"=>"1699841000092614109","Emp_Code"=>"C149815","State"=>"Gurgaon"),
array("user_Id"=>"1699841000145403094","email_id"=>"saransh.sharma@5paisa.com","role_id"=>"1699841000342631771","profile_id"=>"1699841000014596081","reporting_id"=>"1699841000092614109","Emp_Code"=>"C152317","State"=>"Gurgaon"),
array("user_Id"=>"1699841000055816361","email_id"=>"paras.bhatt@5paisa.com","role_id"=>"1699841000342631763","profile_id"=>"1699841000158432348","reporting_id"=>"","Emp_Code"=>"C149146","State"=>"Gurgaon"),
array("user_Id"=>"1699841000092614109","email_id"=>"deepak.ahluwalia@5paisa.com","role_id"=>"1699841000342631763","profile_id"=>"1699841000158432348","reporting_id"=>"","Emp_Code"=>"C150788","State"=>"Gurgaon"));
$userd_id_param="user_Id";
$reporting_id_param="reporting_id";
$role_id_param="role_id";
$profile_id_param="profile_id";
$Emp_Code_param="Emp_Code";
$last_name_param="last_name";
$email_id_param="email_id";
$state_param="State";
foreach ( $movies as $movie ) {
  foreach ( $movie as $key => $value ) {
    error_log ("<dt>$key</dt><dd>$value</dd>");
    if(strpos($key, $userd_id_param)!== false){
      $recordId = $value;
    }
    if(strpos($key, $reporting_id_param)!== false){
      $reporting_id = '"'.$value.'"';
    }
    if(strpos($key, $Emp_Code_param)!== false){
      $Emp_Code = '"'.$value.'"';
    }
    if(strpos($key, $role_id_param)!== false){
      $role_id = '"'.$value.'"';
    }
    if(strpos($key, $profile_id_param)!== false){
      $profile_id = '"'.$value.'"';
    }
    if(strpos($key, $state_param)!== false){
      $state = '"'.$value.'"';
    }
    if(strpos($key, $last_name_param)!== false){
      $last_name = '"'.$value.'"';
    }
    if(strpos($key, $email_id_param)!== false){
      $email_id = '"'.$value.'"';
    }
  }
  $url = "https://www.zohoapis.com/crm/v2/users/{$recordId}";
  error_log($url);
  $accesstokenparam = "Zoho-oauthtoken"." ".$access_token;
  $headers = array("Authorization: $accesstokenparam");
  $content_type = "application/json";
  //$headers->Content-type = $content_type;
  //$headers->Authorization = $accesstokenparam;
  error_log(json_encode($headers));
  $ch = curl_init();
  
  //{ "users":[ {"reporting_id":"reporting_id", "role_id":role_id, "profile_id":"profile_id", "State":"State", "Emp_Code":"Emp_Code" } ] }
  
  $param1 = '{"users":[{"reporting_to_id":';
  //$param1 = '{"users":[{"Emp_Code":';
  //$param10 = ',"reporting_to_id":';
  $reportingid = $reporting_id;
  //$param2 = ', "Emp_Code":';
  $param3 = ', "state":';
  $param5 = ', "role_id":';
  $param6 = ', "profile_id":';
  $param4 = ',}]}'; 
  $json = $param1.$reportingid.$param4;
  //$json = $param1.$last_name.$param10.$reportingid.$param2.$Emp_Code.$param3.$state.$param4;
//  $json = $param1.$reportingid.$param2.$Emp_Code.$param3.$state.$param5.$role_id.$param6.$profile_id.$param4;
 // $json = $param1.$Emp_Code.$param3.$state.$param5.$role_id.$param6.$profile_id.$param4;
  error_log($json);
  $result = json_decode ($json);
  curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
  curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT");
  curl_setopt($ch, CURLOPT_POSTFIELDS,$json);
  curl_setopt($ch, CURLOPT_URL, $url);
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);  
  $st=curl_exec($ch);
  error_log("first response");
  error_log($st);
  $Code = "code";
  $Message = "message";
  $AlternatePhoneNumber = "invalid";
  $AlternatePhoneNumber2 = "FAILURE";
  $arr = (json_decode($st, true));
  foreach ( $arr as $key=>$val ){
    if(strpos($key, $Message)!== false){
      if(strpos($val, $AlternatePhoneNumber)!== false){
        $REFRESH_TOKEN_ID = '1000.e6c1444c8dfe5be81e2071d68c92e76b.0442c58394e29dde316f5be4057484ec';
        $CLIENT_ID = '1000.KCRJ9GWGPIJZ56008726DSCMDAUI8U';
        $CLIENT_SECRET = '034bc2464c3093c42b6605b6297af733557ffcc3cb';
        $accesstokenurl = "https://accounts.zoho.com/oauth/v2/token?refresh_token=1000.e6c1444c8dfe5be81e2071d68c92e76b.0442c58394e29dde316f5be4057484ec&client_id=1000.KCRJ9GWGPIJZ56008726DSCMDAUI8U&client_secret=034bc2464c3093c42b6605b6297af733557ffcc3cb&grant_type=refresh_token";
        //$grant_type = 'refresh_token';
        //error_log($accesstokenurl);
        $tokench = curl_init();
        $myObj->grant_type = $grant_type;
        $myObj->refresh_token = $REFRESH_TOKEN_ID;
        $myObj->client_id = $CLIENT_ID;
        $myObj->client_secret=$CLIENT_SECRET;
        $tokenjson = json_encode($myObj);
        curl_setopt($tokench, CURLOPT_CUSTOMREQUEST, "POST");
        curl_setopt($tokench, CURLOPT_URL, $accesstokenurl);
        curl_setopt($tokench, CURLOPT_RETURNTRANSFER, 1);  
        $tokenst=curl_exec($tokench);
        error_log("token response");
        error_log($tokenst);
        $access_token_param="access_token";
        $arr = (json_decode($tokenst, true));
        foreach ( $arr as $key=>$val ){
          if(strpos($key, $access_token_param)!== false){
            error_log($val);
            $access_token=$val;
            $url = "https://www.zohoapis.com/crm/v2/users/{$recordId}";
            error_log($url);
            $accesstokenparam = "Zoho-oauthtoken"." ".$access_token;
            $headers = array("Authorization: $accesstokenparam");
            $content_type = "application/json";
            error_log(json_encode($headers));
            $ch = curl_init();
            $result = json_decode ($json);
            curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
            curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT");
            curl_setopt($ch, CURLOPT_POSTFIELDS,$json);
            curl_setopt($ch, CURLOPT_URL, $url);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);  
            $st=curl_exec($ch);
            error_log("first response");
            error_log($st);          
          }
        }
      }
    }
  }
}
?>
